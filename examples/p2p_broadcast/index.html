<html>
<head>
  <meta charset="utf-8">
  <title>SkyWay - Broadcast example</title>
  <link rel="stylesheet" href="style.css">
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdn.skyway.io/skyway.js"></script>
  <script>
    // Compatibility shim
    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
    // Peer object
    var peer = new Peer({
      key: 'yourkey0-a515-486b-8488-407b41150e43',
      debug: 3
    });

    peer.on('open', function(){
      $('#my-id').text(peer.id);
    });

    // Receiving a call
    peer.on('call', function(call){
      // Answer the call automatically (instead of prompting user) for demo purposes
      call.answer(window.localStream);
    });

    peer.on('error', function(err){
      alert(err.message);
    });

    // Click handlers setup
    $(function(){
      $('#broadcast').submit(function(e){
        e.preventDefault();
        navigator.getUserMedia({audio: true, video: true}, function(stream){
          // Set your video displays
          $('#video').get(0).srcObject = stream;
          window.localStream = stream;
        }, function(){ $('#step1-error').show(); });
      });
      $('#watch').submit(function(e){
        e.preventDefault();
        // Initiate a call!
        console.log($('#callto-id').val());
        var call = peer.call($('#callto-id').val());
        showBroadcast(call);
      });
    });

    function showBroadcast (call) {
      // Wait for stream on the call, then set peer video display
      call.on('stream', function(stream){
        $('#video').get(0).srcObject = stream;
      });
      call.on('close', function() {
        console.log('connection closed');
      });
    }
  </script>


</head>

<body>

<div class="pure-g">

  <!-- Video area -->
  <div class="pure-u-2-3" id="video-container">
    <video id="video" autoplay></video>
  </div>

  <!-- Steps -->
  <div class="pure-u-1-3">
    <h2>SkyWay Video BroadCast (P2P)</h2>

    <!-- Get local audio/video stream -->
    <div id="step1">
      <p>Your id: <span id="my-id">...</span></p>
      <p>If you are broadcaster, just click Broadcast button and wait for participants.</p>
      <form id="broadcast" class="pure-form">
        <button href="#" class="pure-button pure-button-success" type="submit">Broadcast</button>
      </form>
      <p>If you want to watch broadcasting, enter broadcaster's peer ID and click Watch button.</p>
      <form id="watch" class="pure-form">
        <input type="text" placeholder="Call user id..." id="callto-id">
        <button href="#" class="pure-button pure-button-success" type="submit">Watch</button>
      </form>
    </div>

  </div>
</div>


</body>
</html>
